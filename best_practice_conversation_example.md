# 甲方与高级 AI 的对话最佳实践示例

以下是甲方与 AI 架构师共生成一个高质量监工文档的实际例子，全程以"愿景 -> 约束 -> 拆解 -> 固化"的四步法为核心思想。

---
## 第一阶段：愿景对齐（由大到小）

**甲方：**
我要做一个基于 AI 的自动化周报系统。它能抓取团队在 Slack 和 GitHub 的活动，自动生成每个人的周报草稿并发邮件。我希望它是用 Next.js 做的，界面要极简。请不要写代码，先问我 10 个最关键的问题来确定系统边界。

**AI：**
（生成后询问以下10个问题，如：Slack 数据是否需要权限控制？抓取频率是每周还是更频繁？邮件是否需要支持多语言？是否有特定服务托管需求？等等。）

---
## 第二阶段：深度萃取（定义规则）

**甲方：**
很好，基于刚才的共识，我现在需要你扮演首席架构师。请为接下来的执行 AI 制定一套施工规范：
- 技术栈必须是 Next.js 15 + Tailwind + Resend (发邮件)。
- 必须采用 Schema-First 模式，先定义 Prisma 模型。
- 所有的 API 必须有速率限制。
- 所有的 UI 组件必须使用 shadcn/ui。

**AI：**
好的，我会基于上述需求生成以下执行规范与技术栈清单：
- 技术栈详细如下：Next.js (v15), TailwindCSS, Prisma (Schema-First), Resend API。
- 实现的每个模块必须独立开发，并为核心模块写初步单元测试。
---

## 第三阶段：建立监工协议（关键步骤）

**甲方：**
现在我们要设定 ‘监工 AI’ 的准则来规范执行流程。
- 任何功能的修改必须先写测试用例（Vitest）。
- 如果测试不通过，严禁提交代码。
- 监工 AI 必须每小时自动运行一次 `npm run lint` 和 `type-check`。
- 遇到逻辑冲突时优先保证数据一致性，而不是响应速度。

**AI：**
（根据以上输入，生成以下关键监工逻辑）：
1. 定时自动化检查：运行 `npm run build`, `lint` 并尝试失败修复。
2. 环境变量 (.env) 检测，防止意外泄露。
3. 数据一致性优于性能优化。

---

## 第四阶段：生成并固化 “种子文档”

**甲方：**
请基于上述所有内容生成项目需求种子文档，放到项目根目录，保存为 blueprint.md。

**AI:**
生成种子文档如下：
```markdown name=blueprint.md
# AI 监工指令集 (Blueprint v1.0)

## 1. 核心意图
构建自动化周报系统。逻辑：从 Slack/GitHub 抓取数据 -> AI 总结 -> Resend 发送。

## 2. 开发者协议 (Execution Protocol)
- **TDD 强制：** 必须先在 `__tests__` 目录下创建测试。
- **原子提交：** 每个功能点必须独立提交，Message 格式：`feat: [模块名] 描述`。
- **工具链：** 使用 [Prisma](www.prisma.io) 维护数据库变更，严禁手动修改数据库。

## 3. 监工逻辑 (Supervision Logic)
- **自愈机制：** 若 `npm run build` 失败，Agent 必须读取错误日志并尝试至少 3 次修复。
- **安全红线：** 环境变量 (.env) 严禁通过任何 API 泄露，所有 Secret 必须走服务端读取。

## 4. 验收标准
- 核心流程端到端（E2E）测试覆盖率需达 100%。
- 页面在 Lighthouse 性能评分必须 > 90。
```

此文档的制定过程展现了从愿景萃取到执行协议制定，以及到最后种子文档生成的完整流程，具有极高的实战指导意义。